{
  "active": true,
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-19T16:36:22.026Z",
  "id": "SQyhRdB06F1cswSG",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Agent with mcp",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        -48
      ],
      "id": "3be48f8d-e91d-4db1-8c4f-fd4f2fcd6dba",
      "name": "When chat message received",
      "webhookId": "c629e6eb-30fc-4400-828b-baa8c6fdf640"
    },
    {
      "parameters": {
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "=system_message: |\n  B·∫°n l√† m·ªôt Agent ch·∫°y trong n8n, nh·∫≠n input t·ª´ Lark Chat (chat trigger) v√† x·ª≠ l√Ω y√™u c·∫ßu th√¥ng qua MCP Client.\n\n  üéØ Nhi·ªám v·ª•:\n  - Hi·ªÉu y√™u c·∫ßu t·ª± nhi√™n t·ª´ tin nh·∫Øn trong Lark Chat.\n  - X√°c ƒë·ªãnh t√°c v·ª• t∆∞∆°ng ·ª©ng (v√≠ d·ª•: t·∫°o b·∫£ng, th√™m record, c·∫≠p nh·∫≠t d·ªØ li·ªáu, g·ª≠i th√¥ng b√°o).\n  - Th·ª±c hi·ªán t√°c v·ª• b·∫±ng c√°ch g·ªçi Lark API qua MCP Client.\n  - Ph·∫£n h·ªìi k·∫øt qu·∫£ l·∫°i cho ng∆∞·ªùi d√πng trong Chat.\n\n  üß© Ng·ªØ c·∫£nh ho·∫°t ƒë·ªông:\n  - Input l√† m·ªôt tin nh·∫Øn t·ª´ chat trigger (text).\n  - B·∫°n c√≥ th·ªÉ g·∫∑p 2 lo·∫°i input:\n    1. Y√™u c·∫ßu thao t√°c d·ªØ li·ªáu: ‚ÄúT·∫°o b·∫£ng Orders‚Äù, ‚ÄúTh√™m ƒë∆°n h√†ng 1234 v·ªõi s·ªë ti·ªÅn 500000‚Äù.\n    2. Y√™u c·∫ßu truy v·∫•n: ‚ÄúLi·ªát k√™ c√°c ƒë∆°n h√†ng h√¥m nay‚Äù, ‚ÄúC√≥ bao nhi√™u record trong b·∫£ng Customers‚Äù.\n  - B·∫°n ph·∫£i ph√¢n t√≠ch ng·ªØ c·∫£nh, map th√†nh action t∆∞∆°ng ·ª©ng, v√† g·ªçi tool MCP ph√π h·ª£p.\n\n  üì¶ Quy t·∫Øc x·ª≠ l√Ω:\n  - N·∫øu y√™u c·∫ßu li√™n quan ƒë·∫øn Lark Base ‚Üí s·ª≠ d·ª•ng c√°c tool `base.createTable`, `base.insertRecord`, `base.queryRecord`.\n  - N·∫øu y√™u c·∫ßu l√† nh·∫Øc nh·ªü/th√¥ng b√°o ‚Üí d√πng `chat.sendMessage`.\n  - Lu√¥n confirm l·∫°i b·∫±ng output r√µ r√†ng cho ng∆∞·ªùi d√πng.\n  - N·∫øu thi·∫øu th√¥ng tin (v√≠ d·ª•: t√™n b·∫£ng kh√¥ng c√≥, field kh√¥ng r√µ) ‚Üí h·ªèi l·∫°i trong chat thay v√¨ th·ª±c hi·ªán sai.\n  - Khi khai b√°o parameter schema cho tool, ƒë·∫£m b·∫£o:\n      ‚Ä¢ N·∫øu d√πng enum ‚Üí t·∫•t c·∫£ gi√° tr·ªã enum ƒë·ªÅu l√† string (\"1\", \"2\", \"3\" ‚Ä¶).\n      ‚Ä¢ N·∫øu gi√° tr·ªã l√† s·ªë, chuy·ªÉn sang string tr∆∞·ªõc khi truy·ªÅn v√†o (v√≠ d·ª• \"500000\" thay v√¨ 500000).\n      ‚Ä¢ Lu√¥n match type ch√≠nh x√°c theo JSON Schema (string, integer, boolean).\n\n  üí¨ Phong c√°ch ph·∫£n h·ªìi:\n  - Ng·∫Øn g·ªçn, d·ªÖ hi·ªÉu, c√≥ ID x√°c nh·∫≠n khi thao t√°c th√†nh c√¥ng.\n  - N·∫øu l·ªói, n√≥i r√µ nguy√™n nh√¢n (thi·∫øu quy·ªÅn, token sai, b·∫£ng ch∆∞a t·ªìn t·∫°i).\n  - Khi c·∫ßn clarification, h·ªèi l·∫°i user trong chat theo c√°ch t·ª± nhi√™n.\n\n  üöÄ V√≠ d·ª• h√†nh vi:\n  - User nh·∫Øn: ‚ÄúT·∫°o b·∫£ng Orders c√≥ c·ªôt order_id, customer, amount‚Äù\n    ‚Üí Agent g·ªçi MCP t·∫°o b·∫£ng ‚Üí Tr·∫£ l·ªùi: ‚Äú‚úÖ ƒê√£ t·∫°o b·∫£ng Orders v·ªõi ID tbl_12345‚Äù\n  - User nh·∫Øn: ‚ÄúTh√™m ƒë∆°n h√†ng 5678 c·ªßa kh√°ch An, gi√° 2000000‚Äù\n    ‚Üí Agent g·ªçi MCP insertRecord ‚Üí Output: ‚Äú‚úÖ ƒê∆°n h√†ng 5678 ƒë√£ l∆∞u (record_id rec_99999)‚Äù\n  - User nh·∫Øn: ‚ÄúLi·ªát k√™ ƒë∆°n h√†ng h√¥m nay‚Äù\n    ‚Üí Agent queryRecord ‚Üí Output: ‚Äúüìä C√≥ 12 ƒë∆°n h√†ng h√¥m nay, t·ªïng gi√° tr·ªã 24000000‚Äù\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        224,
        -48
      ],
      "id": "31034406-9658-4349-bbbf-fb9d4849648d",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -176,
        240
      ],
      "id": "db75d118-21b5-45e9-943e-3e31a6aaaa07",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "DO3eNJoYSeKcYIVp",
          "name": "DUyAPI"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 5e+71
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        336,
        256
      ],
      "id": "343f1171-aca7-4ca0-bc96-956af694fa4c",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "endpointUrl": "https://anycross-sg.larksuite.com/mcp/b9195369-b3d1-4d77-a895-f6be57714379/stream?key=X1jIlyRQN0usXiS1EZ68ZdMzCuxRRZ-mgH6BxX_EXZCyQ_Mb_dGZuyJf8WXzlVjB",
        "serverTransport": "httpStreamable",
        "authentication": "headerAuth",
        "include": "except"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        544,
        192
      ],
      "id": "a1059298-6c49-4dd4-b362-57b9509489b3",
      "name": "MCP Client",
      "credentials": {
        "httpHeaderAuth": {
          "id": "3C2Zgpa4fIQiLocs",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        144,
        240
      ],
      "id": "e1aa157a-05d0-4458-b183-045a36ae86c9",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "DO3eNJoYSeKcYIVp",
          "name": "DUyAPI"
        }
      }
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-08-19T16:36:22.030Z",
      "updatedAt": "2025-08-19T16:36:22.030Z",
      "role": "workflow:owner",
      "workflowId": "SQyhRdB06F1cswSG",
      "projectId": "HmG9Xuclf9YeLvw5"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-08-20T01:34:38.000Z",
  "versionId": "a18e7457-3fd3-47e4-8e7c-ab7302d4df38"
}